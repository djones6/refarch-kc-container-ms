



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Pre-requisites - Reefer Container Management Service</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#environment-pre-requisites" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Reefer Container Management Service" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Reefer Container Management Service
            </span>
            <span class="md-header-nav__topic">
              
                Pre-requisites
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Reefer Container Management Service" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Reefer Container Management Service
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ES2DDD2MS/" title="Analysis and design considerations" class="md-nav__link">
      Analysis and design considerations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Different implementations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Different implementations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../kstreams/" title="Kafka Streams Implementation" class="md-nav__link">
      Kafka Streams Implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../springboot/" title="Springboot - Kafka and PostgreSQL Implementation" class="md-nav__link">
      Springboot - Kafka and PostgreSQL Implementation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../flask/" title="Python Flask and Kafka Implementation" class="md-nav__link">
      Python Flask and Kafka Implementation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Deployments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Deployments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Pre-requisites
      </label>
    
    <a href="./" title="Pre-requisites" class="md-nav__link md-nav__link--active">
      Pre-requisites
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deployment-prerequisites" class="md-nav__link">
    Deployment prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-deployment" class="md-nav__link">
    Local deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-minikube-or-docker-edge-kubernetes" class="md-nav__link">
    Prepare minikube or docker edge / kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#or-use-docker-compose" class="md-nav__link">
    Or use docker compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-cloud-deployment" class="md-nav__link">
    Public cloud deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-an-ibm-kubernetes-service-cluster" class="md-nav__link">
    Prepare an IBM Kubernetes service cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-event-stream-service-on-ibm-cloud" class="md-nav__link">
    Prepare Event Stream service on IBM Cloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-postgresql-service-on-ibm-cloud" class="md-nav__link">
    Prepare Postgresql service  on IBM Cloud
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-cloud" class="md-nav__link">
    Private Cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-openshift-container-platform-ocp" class="md-nav__link">
    Deploy to OpenShift Container Platform (OCP)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-to-ocp-311" class="md-nav__link">
    Deploy to OCP 3.11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../springboot/" title="Run spring boot app locally" class="md-nav__link">
      Run spring boot app locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cicd/" title="Continuous delivery" class="md-nav__link">
      Continuous delivery
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../springboot/#security" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../springboot/#the-integration-tests" title="Run integration tests" class="md-nav__link">
      Run integration tests
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-reefer-ml/" title="Reefer Container Predictive Maintenance" class="md-nav__link">
      Reefer Container Predictive Maintenance
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deployment-prerequisites" class="md-nav__link">
    Deployment prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-deployment" class="md-nav__link">
    Local deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-minikube-or-docker-edge-kubernetes" class="md-nav__link">
    Prepare minikube or docker edge / kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#or-use-docker-compose" class="md-nav__link">
    Or use docker compose
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-cloud-deployment" class="md-nav__link">
    Public cloud deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-an-ibm-kubernetes-service-cluster" class="md-nav__link">
    Prepare an IBM Kubernetes service cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-event-stream-service-on-ibm-cloud" class="md-nav__link">
    Prepare Event Stream service on IBM Cloud
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-postgresql-service-on-ibm-cloud" class="md-nav__link">
    Prepare Postgresql service  on IBM Cloud
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-cloud" class="md-nav__link">
    Private Cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-to-openshift-container-platform-ocp" class="md-nav__link">
    Deploy to OpenShift Container Platform (OCP)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-to-ocp-311" class="md-nav__link">
    Deploy to OCP 3.11
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-kc-container-ms/edit/master/docs/deployment.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="environment-pre-requisites">Environment pre-requisites</h1>
<h2 id="deployment-prerequisites">Deployment prerequisites</h2>
<p>Regardless of specific deployment targets (OCP, IKS, k8s), the following prerequisite Kubernetes artifacts need to be created to support the deployments of application components.  These artifacts need to be created once per unique deployment of the entire application and can be shared between application components in the same overall application deployment.</p>
<ol>
<li>Create <code>kafka-brokers</code> ConfigMap</li>
<li>Command: <code>kubectl create configmap kafka-brokers --from-literal=brokers='&lt;replace with comma-separated list of brokers&gt;' -n &lt;namespace&gt;</code></li>
<li>
<p>Example: <code>kubectl create configmap kafka-brokers --from-literal=brokers='broker-3-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-2-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-1-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-5-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-0-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093,broker-4-j7fxtxtp5fs84205.kafka.svc01.us-south.eventstreams.cloud.ibm.com:9093' -n eda-refarch</code></p>
</li>
<li>
<p>Create optional <code>eventstreams-apikey</code> Secret, if you are using Event Streams as your Kafka broker provider</p>
</li>
<li>Command: <code>kubectl create secret generic eventstreams-apikey --from-literal=binding='&lt;replace with api key&gt;' -n &lt;namespace&gt;</code></li>
<li>
<p>Example: <code>kubectl create secret generic eventstreams-apikey --from-literal=binding='z...12345...notanactualkey...67890...a' -n eda-refarch</code></p>
</li>
<li>
<p>If you are using Event Streams as your Kafka broker provider and it is deployed via the IBM Cloud Pak for Integration (ICP4I), you will need to create an additional Secret to store the generated Certificates &amp; Truststores.</p>
</li>
<li>From the "Connect to this cluster" tab on the landing page of your Event Streams installation, download both the <strong>Java truststore</strong> and the <strong>PEM certificate</strong>.</li>
<li>Create the Java truststore Secret:<ul>
<li>Command: <code>kubectl create secret generic &lt;secret-name&gt; --from-file=/path/to/downloaded/file.jks</code></li>
<li>Example: <code>kubectl create secret generic es-truststore-jks --from-file=/Users/osowski/Downloads/es-cert.jks</code></li>
</ul>
</li>
<li>
<p>Create the PEM certificate Secret:</p>
<ul>
<li>Command: <code>kubectl create secret generic &lt;secret-name&gt; --from-file=/path/to/downloaded/file.pem</code></li>
<li>Example: <code>kubectl create secret generic es-ca-pemfile --from-file=/Users/osowski/Downloads/es-cert.pem</code></li>
</ul>
</li>
<li>
<p>Create <code>postgresql-ca-pem</code> Secret</p>
</li>
<li>Install the IBM Cloud Database CLI Plugin:<ul>
<li><code>ibmcloud plugin install cloud-databases</code></li>
</ul>
</li>
<li>Get the certificate using the name of the postgresql service:<ul>
<li><code>ibmcloud cdb deployment-cacert &lt;name of postgresql instance&gt; --save</code></li>
<li><code>export CERT_FILE=$(ibmcloud cdb deployment-cacert gse-eda-sandbox-db --save | grep "Certificate written to" | sed "s/Certificate written to //")</code></li>
</ul>
</li>
<li>Add it into an environment variable<ul>
<li><code>export POSTGRESQL_CA_PEM="$(cat CERT_FILE)"</code></li>
</ul>
</li>
<li>
<p>Create the secret:</p>
<ul>
<li><code>kubectl create secret generic postgresql-ca-pem --from-literal=binding="$POSTGRESQL_CA_PEM" -n browncompute</code></li>
</ul>
</li>
<li>
<p>Create <code>postgresql-url</code> Secret</p>
</li>
<li>Command: <code>kubectl create secret generic postgresql-url --from-literal=binding='&lt;replace with postgresql url&gt;' -n &lt;namespace&gt;</code></li>
<li>
<p>Example: <code>kubectl create secret generic postgresql-url --from-literal=binding='jdbc:postgresql://58...77f.databases.appdomain.cloud:32569/ibmclouddb?sslmode=verify-full&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory' -n eda-refarch</code></p>
</li>
<li>
<p>Create <code>postgresql-user</code> Secret</p>
</li>
<li>Command: <code>kubectl create secret generic postgresql-user --from-literal=binding='&lt;replace with postgresql user&gt;' -n &lt;namespace&gt;</code></li>
<li>
<p>Example: <code>kubectl create secret generic postgresql-user --from-literal=binding='postgresqlUser' -n eda-refarch</code></p>
</li>
<li>
<p>Create <code>postgresql-pwd</code> Secret</p>
</li>
<li>Command: <code>kubectl create secret generic postgresql-pwd --from-literal=binding='&lt;replace with postgresql password&gt;' -n &lt;namespace&gt;</code></li>
<li>Example: <code>kubectl create secret generic postgresql-pwd --from-literal=binding='postgresqlPassword' -n eda-refarch</code></li>
</ol>
<h2 id="local-deployment">Local deployment</h2>
<h3 id="prepare-minikube-or-docker-edge-kubernetes">Prepare minikube or docker edge / kubernetes</h3>
<ul>
<li>The solution can run on minikube, and once you have a minikube or docker community edition with kubernetes enabled, you can follow the instructions from <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/minikube/">this note</a>.</li>
</ul>
<h3 id="or-use-docker-compose">Or use docker compose</h3>
<p>See how to use docker-compose to run backend service and the solution in <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/local/">this article.</a></p>
<h2 id="public-cloud-deployment">Public cloud deployment</h2>
<h3 id="prepare-an-ibm-kubernetes-service-cluster">Prepare an IBM Kubernetes service cluster</h3>
<p>See <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/iks/#kubernetes-cluster-service">this note on how to deploy a IKS cluster</a>.</p>
<p>Define a docker image private registry using <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/iks/#define-an-image-private-repository">this note.</a></p>
<p>Define a namespace to deploy your solution. We used <code>greencompute</code> as namespace but can be anything.</p>
<div class="codehilite"><pre><span></span><span class="n">kubectl</span> <span class="k">create</span> <span class="n">namespace</span> <span class="n">greencompute</span>
</pre></div>

<h3 id="prepare-event-stream-service-on-ibm-cloud">Prepare Event Stream service on IBM Cloud</h3>
<p>See <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/iks/#event-streams-service-on-ibm-cloud">this note to deploy IBM kafka based product as a service on IBM Cloud</a>.</p>
<p>Get API Key and brokers URL. Then defines secrets for the api key as described <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/iks/#event-stream-api-key">in this note.</a></p>
<p>Add the private token to access the docker image registry, see <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/iks/#private-registry-token">details in this note.</a></p>
<h3 id="prepare-postgresql-service-on-ibm-cloud">Prepare Postgresql service  on IBM Cloud</h3>
<p>Follow <a href="https://cloud.ibm.com/catalog/services/databases-for-postgresql">product documentation.</a></p>
<p>Then add secrets for postgresql by following the procedure described <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/iks/#postgresql-url-user-pwd-and-ca-certificate-as-secrets">in this note.</a></p>
<h2 id="private-cloud">Private Cloud</h2>
<p>For <a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/icp/"> IBM Cloud Private deployments go to this article.</a></p>
<h2 id="deploy-to-openshift-container-platform-ocp">Deploy to OpenShift Container Platform (OCP)</h2>
<h3 id="deploy-to-ocp-311">Deploy to OCP 3.11</h3>
<p><strong>Cross-component deployment prerequisites:</strong> <em>(needs to be done once per unique deployment of the entire application)</em>
1. If desired, create a non-default Service Account for usage of deploying and running the K Container reference implementation.  This will become more important in future iterations, so it's best to start small:
  - Command: <code>oc create serviceaccount -n &lt;target-namespace&gt; kcontainer-runtime</code>
  - Example: <code>oc create serviceaccount -n eda-refarch kcontainer-runtime</code>
2. The target Service Account needs to be allowed to run containers as <code>anyuid</code> for the time being:
  - Command: <code>oc adm policy add-scc-to-user anyuid -z &lt;service-account-name&gt; -n &lt;target-namespace&gt;</code>
  - Example: <code>oc adm policy add-scc-to-user anyuid -z kcontainer-runtime -n eda-refarch</code>
  - NOTE: This requires <code>cluster-admin</code> level privileges.</p>
<p><strong>Perform the following for the <code>SpringContainerMS</code> microservice:</strong>
1. Build and push the Docker image by one of the two options below:
  - Create a Jenkins project, pointing to the remote GitHub repository for the <code>voyages-ms</code> microservice, and manually creating the necessary parameters.  Refer to the individual microservice's <a href="../SpringContainerMS/Jenkinsfile.NoKubernetesPlugin"><code>Jenkinsfile.NoKubernetesPlugin</code></a> for appropriate parameter values.
  - Manually build the Docker image and push it to a registry that is accessible from your cluster (Docker Hub, IBM Cloud Container Registry, manually deployed Quay instance):
    - <code>docker build -t &lt;private-registry&gt;/&lt;image-namespace&gt;/kc-spring-container-ms:latest SpringContainerMS/</code>
    - <code>docker login &lt;private-registry&gt;</code>
    - <code>docker push &lt;private-registry&gt;/&lt;image-namespace&gt;/kc-spring-container-ms:latest</code>
3. Generate application YAMLs via <code>helm template</code>:
  - Parameters:
    - <code>--set image.repository=&lt;private-registry&gt;/&lt;image-namespace&gt;/&lt;image-repository&gt;</code>
    - <code>--set image.pullSecret=&lt;private-registry-pullsecret&gt;</code> (only required if pulling from an external private registry)
    - <code>--set kafka.brokersConfigMap=&lt;kafka brokers ConfigMap name&gt;</code>
    - <code>--set eventstreams.enabled=(true/false)</code> (<code>true</code> when connecting to Event Streams of any kind, <code>false</code> when connecting to Kafka directly)
    - <code>--set eventstreams.apikeyConfigMap=&lt;kafka api key Secret name&gt;</code>
    - <code>--set eventstreams.truststoreRequired=(true/false)</code> (<code>true</code> when connecting to Event Streams via ICP4I)
    - <code>--set eventstreams.truststoreSecret=&lt;eventstreams jks file secret name&gt;</code> (only used when connecting to Event Streams via ICP4I)
    - <code>--set eventstreams.truststorePassword=&lt;eventstreams jks password&gt;</code> (only used when connecting to Event Streams via ICP4I)
    - <code>--set postgresql.capemRequired=(true/false)</code> (<code>true</code> when connecting to Postgresql Services requiring SSL and CA PEM-secured communication)
    - <code>--set postgresql.capemSecret=&lt;postgresql CA pem certificate Secret name&gt;</code>
    - <code>--set postgresql.urlSecret=&lt;postgresql url Secret name&gt;</code>
    - <code>--set postgresql.userSecret=&lt;postgresql user Secret name&gt;</code>
    - <code>--set postgresql.passwordSecret=&lt;postgresql password Secret name&gt;</code>
    - <code>--set serviceAccountName=&lt;service-account-name&gt;</code>
    - <code>--namespace &lt;target-namespace&gt;</code>
    - <code>--output-dir &lt;local-template-directory&gt;</code>
  - Example using Event Streams via ICP4I:
   <div class="codehilite"><pre><span></span>helm template --set image.repository<span class="o">=</span>rhos-quay.internal-network.local/browncompute/kc-spring-container-ms --set kafka.brokersConfigMap<span class="o">=</span>es-kafka-brokers --set eventstreams.enabled<span class="o">=</span><span class="nb">true</span> --set eventstreams.apikeyConfigMap<span class="o">=</span>es-eventstreams-apikey --set eventstreams.truststoreRequired<span class="o">=</span><span class="nb">true</span> --set eventstreams.truststoreSecret<span class="o">=</span>es-truststore-jks --set eventstreams.truststorePassword<span class="o">=</span>password --set postgresql.capemRequired<span class="o">=</span><span class="nb">true</span> --set postgresql.capemSecret<span class="o">=</span>postgresql-ca-pem --set postgresql.urlSecret<span class="o">=</span>postgresql-url --set postgresql.userSecret<span class="o">=</span>postgresql-user --set postgresql.passwordSecret<span class="o">=</span>postgresql-pwd --set <span class="nv">serviceAccountName</span><span class="o">=</span>kcontainer-runtime --output-dir templates --namespace eda-refarch chart/springcontainerms
</pre></div>
  - Example using Event Streams hosted on IBM Cloud:
  <div class="codehilite"><pre><span></span>helm template --set image.repository<span class="o">=</span>rhos-quay.internal-network.local/browncompute/kc-spring-container-ms --set kafka.brokersConfigMap<span class="o">=</span>es-kafka-brokers --set eventstreams.enabled<span class="o">=</span><span class="nb">true</span> --set eventstreams.apikeyConfigMap<span class="o">=</span>es-eventstreams-apikey --set postgresql.capemRequired<span class="o">=</span><span class="nb">true</span> --set postgresql.capemSecret<span class="o">=</span>postgresql-ca-pem --set postgresql.urlSecret<span class="o">=</span>postgresql-url --set postgresql.userSecret<span class="o">=</span>postgresql-user --set postgresql.passwordSecret<span class="o">=</span>postgresql-pwd --set <span class="nv">serviceAccountName</span><span class="o">=</span>kcontainer-runtime --output-dir templates --namespace eda-refarch chart/springcontainerms
</pre></div></p>
<ol>
<li>Deploy application using <code>oc apply</code>:</li>
<li><code>oc apply -f templates/springcontainerms/templates</code></li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../flask/" title="Python Flask and Kafka Implementation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Python Flask and Kafka Implementation
              </span>
            </div>
          </a>
        
        
          <a href="../springboot/" title="Run spring boot app locally" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Run spring boot app locally
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>